(this.webpackJsonpbattleship=this.webpackJsonpbattleship||[]).push([[0],{41:function(t,e,n){},42:function(t,e,n){},43:function(t,e,n){},44:function(t,e,n){},45:function(t,e,n){},46:function(t,e,n){},52:function(t,e,n){},53:function(t,e,n){},90:function(t,e,n){},91:function(t,e,n){"use strict";n.r(e);var i,o=n(0),r=n(1),s=n.n(r),a=n(8),c=n.n(a),l=(n(41),n(4)),u=(n(42),n(7)),h=n(18),p=n(22),d=n(10),f=n(11),v=n(3);!function(t){t[t.empty=0]="empty",t[t.missed=1]="missed",t[t.shipIntact=2]="shipIntact",t[t.shipHit=3]="shipHit",t[t.shipSunk=4]="shipSunk",t[t.knownEmpty=5]="knownEmpty"}(i||(i={}));var b=function(){function t(){Object(d.a)(this,t),this.cells=void 0,this.nextShipPlacement=null,this.isNextShipPlacementValid=!1,this.haveAllShipsSunk=!1,this.ships=[],this.sunkShipsInfo={},this._arePositionsLocked=!1,Object(v.d)(this),this.cells=this.initializeBoard()}return Object(f.a)(t,[{key:"initializeBoard",value:function(){return Array.from({length:10}).map((function(t){return Array.from({length:10}).map((function(t){return i.empty}))}))}},{key:"clear",value:function(){this.ships=[],this.nextShipPlacement=null,this.haveAllShipsSunk=!1,this.sunkShipsInfo={},this.cells=this.initializeBoard()}},{key:"prepareToPlaceShip",value:function(t){if(!t)throw new Error("No ship placement provided.");var e=t.ship,n=t.direction,i=t.row,o=t.column,r=i>=0&&o>=0&&("horizontal"===n?o:i)+e.size<=10;this.isNextShipPlacementValid=r&&!this.wouldShipsBeInContact(t),this.nextShipPlacement=t}},{key:"placeShip",value:function(){if(!this.nextShipPlacement)throw new Error("Can't place ship as there isn't one ready to place.");if(this.isNextShipPlacementValid){var t=this.nextShipPlacement.ship.size,e=this.predictCellsInShip(this.nextShipPlacement),n=this.nextShipPlacement.ship;n.cellPositions=e,n.direction=this.nextShipPlacement.direction,this.setStateOfCells(e,i.shipIntact),this.ships.push(n),this.isNextShipPlacementValid=!1,this.nextShipPlacement=null,this.sunkShipsInfo[t]={quantity:this.sunkShipsInfo[t]?this.sunkShipsInfo[t].quantity+1:1,sunk:0}}}},{key:"lockShipsInPlace",value:function(){this._arePositionsLocked=!0}},{key:"findCellsWithState",value:function(t){for(var e=[],n=0;n<10;n++)for(var i=0;i<10;i++){var o=this.cells[n][i];t.includes(o)&&e.push([n,i])}return e}},{key:"receiveAttack",value:function(t){var e=this.findShipAt(t);if(this.setStateOfCells([t],e?i.shipHit:i.missed),e){var n=e.cellPositions.find((function(e){return e[0]===t[0]&&e[1]===t[1]}));if(!n)throw new Error("Hmm... a ship was attacked but its attacked cell cannot be found.");var o=e.cellPositions.indexOf(n);e.hit(o),e.isSunk&&this.handleSunkShip(e),this.haveAllShipsSunk=this.ships.every((function(t){return t.hits.every((function(t){return"hit"===t}))}))}}},{key:"handleSunkShip",value:function(t){var e=this;t.cellPositions.forEach((function(t){e.cells[t[0]][t[1]]=i.shipSunk;var n=[].concat(Object(p.a)(e.getAdjacentCellPositions(t)),Object(p.a)(e.getCornerCellPositions(t))).filter((function(t){return void 0!==t})).filter((function(t){return e.cells[t[0]][t[1]]===i.empty}));e.setStateOfCells(n,i.knownEmpty)})),this.sunkShipsInfo[t.size].sunk+=1}},{key:"removeShipAt",value:function(t){var e=this.findShipAt(t);e&&(this.setStateOfCells(e.cellPositions,i.empty),this.ships=this.ships.filter((function(t){return t!==e})),this.sunkShipsInfo[e.size].quantity-=1)}},{key:"rotateShipAt",value:function(t){var e=this.findShipAt(t);if(!e)throw new Error("Can't rotate. No ship found at (".concat(t[0],", ").concat(t[1],")."));var n=e.cellPositions;this.setStateOfCells(n,i.empty);var o="horizontal"===e.direction?"vertical":"horizontal",r={ship:e,direction:o,row:e.originPosition[0],column:e.originPosition[1]};this.prepareToPlaceShip(r),this.isNextShipPlacementValid?(e.direction=o,this.ships=this.ships.filter((function(t){return t!==e})),this.placeShip()):this.setStateOfCells(n,i.shipIntact)}},{key:"findShipAt",value:function(t){return this.ships.find((function(e){return e.cellPositions.some((function(e){return e[0]===t[0]&&e[1]===t[1]}))}))}},{key:"wouldShipsBeInContact",value:function(t){var e,n=this.predictCellsInShip(t),o=Object(h.a)(n);try{for(o.s();!(e=o.n()).done;){var r=e.value;if(!this.getSurroundingCellStates(r).filter((function(t){return void 0!==t})).every((function(t){return t===i.empty})))return!0}}catch(s){o.e(s)}finally{o.f()}return!1}},{key:"getSurroundingCellStates",value:function(t){for(var e=t[0],n=t[1],i=[],o=e-1;o<=e+1;o++)for(var r=n-1;r<=n+1;r++){var s=r>=0&&r<=9,a=o>=0&&o<=9?this.cells[o]:void 0,c=a&&s?a[r]:void 0;i.push(c)}return i}},{key:"getCornerCellStates",value:function(t){var e=this.getSurroundingCellStates(t);return[e[0],e[2],e[6],e[8]]}},{key:"getAdjacentCellStates",value:function(t){var e=this.getSurroundingCellStates(t);return[e[1],e[3],e[5],e[7]]}},{key:"getCornerCellPositions",value:function(t){var e=t[0]-1>=0,n=t[0]+1<=9,i=t[1]-1>=0,o=t[1]+1<=9;return[e&&i?[t[0]-1,t[1]-1]:void 0,e&&o?[t[0]-1,t[1]+1]:void 0,n&&i?[t[0]+1,t[1]-1]:void 0,n&&o?[t[0]+1,t[1]+1]:void 0]}},{key:"getAdjacentCellPositions",value:function(t){return[t[0]-1>=0?[t[0]-1,t[1]]:void 0,t[1]-1>=0?[t[0],t[1]-1]:void 0,t[1]+1<=9?[t[0],t[1]+1]:void 0,t[0]+1<=9?[t[0]+1,t[1]]:void 0]}},{key:"predictCellsInShip",value:function(t){if(!t)throw new Error("No ship placement provided.");for(var e=t.ship,n=t.direction,i=t.row,o=t.column,r=[],s=0;s<e.size;s++)"horizontal"===n?r.push([i,o+s]):"vertical"===n&&r.push([i+s,o]);return r}},{key:"setStateOfCells",value:function(t,e){var n=this;t.forEach((function(t){return n.cells[t[0]][t[1]]=e}))}},{key:"numberOfShipsWithSize",value:function(t){return this.ships.filter((function(e){return e.size===t})).length}},{key:"arePositionsLocked",get:function(){return this._arePositionsLocked}}]),t}(),m=function(){function t(e){Object(d.a)(this,t),this.size=void 0,this.hits=void 0,this.isSunk=!1,this.direction="horizontal",this._cellPositions=[],this._originPosition=[-1,-1],this.size=e,this.hits=this.initializeHits()}return Object(f.a)(t,[{key:"initializeHits",value:function(){return Array.from({length:this.size}).map((function(t){return"intact"}))}},{key:"hit",value:function(t){this.hits[t]="hit",this.isSunk=this.hits.every((function(t){return"hit"===t}))}},{key:"cellPositions",get:function(){return this._cellPositions},set:function(t){this._cellPositions=t,this._originPosition=t.reduce((function(t,e){return[Math.min(t[0],e[0]),Math.min(t[1],e[1])]}),[10,10])}},{key:"originPosition",get:function(){return this._originPosition}}]),t}(),j=(n(43),Object(l.a)((function(t){var e=t.cell,n=t.owner,s=t.index,a=Object(r.useRef)(null),c=n.board;function l(){return[Math.floor(s/10),s%10]}function h(t){var e=l(),n=Object(u.a)(e,2),i=n[0],o=n[1],r=t.detail,s=r.size,a=r.direction,h=r.dragStop,p=r.setIsDropPositionValid,d={ship:new m(s),direction:a,row:i,column:o};c.prepareToPlaceShip(d),c.isNextShipPlacementValid?(p(!0),h&&c.placeShip()):p(!1)}return Object(r.useEffect)((function(){var t=a.current;return t.addEventListener("shipDrag",h),function(){return t.removeEventListener("shipDrag",h)}}),[]),Object(o.jsx)("div",{ref:a,className:"board-cell ".concat(function(t){var e="";if(e=["","cell-missed","","cell-hit","cell-sunk","cell-known-empty"][t],"human"===n.type)t===i.shipIntact&&(e+=" cell-user",c.arePositionsLocked||(e+=" cell-removeable")),c.arePositionsLocked&&(e+=" cell-uninteractable");else if(t!==i.empty&&t!==i.shipIntact)e+=" cell-uninteractable";else if(t===i.shipIntact){var o;(c.haveAllShipsSunk||(null===(o=n.opponent)||void 0===o?void 0:o.board.haveAllShipsSunk))&&(e+=" cell-user")}return 0===s?e+=" cell-top-left":9===s?e+=" cell-top-right":90===s?e+=" cell-bottom-left":99===s&&(e+=" cell-bottom-right"),"cpu"===n.type&&(e+=" cell-hoverable"),e}(e)),onClick:function(){var t,e=l(),o=Object(u.a)(e,2),r=o[0],s=o[1];c.arePositionsLocked?null===(t=n.opponent)||void 0===t||t.attack([r,s]):c.cells[r][s]===i.shipIntact&&c.removeShipAt([r,s])}})}))),S=(n(44),Object(l.a)((function(t){var e=t.board,n=[];for(var i in e.sunkShipsInfo)n.push({shipSize:parseInt(i),quantity:e.sunkShipsInfo[i].quantity,sunk:e.sunkShipsInfo[i].sunk});return Object(o.jsxs)("div",{className:"sunk-indicators-container",children:[Object(o.jsx)("div",{className:"sunk-ships-indicator-label",children:"Sunk ships"}),n.map((function(t){return Object(o.jsx)("div",{children:Array.from({length:t.quantity}).map((function(e,n){return Object(o.jsx)("span",{className:"sunk-indicator",children:Array.from({length:t.shipSize}).map((function(e,i){return Object(o.jsx)("span",{className:"indicator-cell ".concat(n<t.sunk?"indicator-sunk":"indicator-not-sunk")},i)}))},n)}))},t.shipSize)}))]})}))),k=Object(l.a)((function(t){var e,n=t.owner,i=n.board.haveAllShipsSunk||(null===(e=n.opponent)||void 0===e?void 0:e.board.haveAllShipsSunk);return Object(o.jsxs)("div",{className:"board-display-container",children:[Object(o.jsx)("div",{className:"board-owner-label",children:"human"===n.type?"Your board":"Opponent's board"}),Object(o.jsx)("div",{className:"board-grid ".concat(function(){var t="";i?t+="disabled-board":n.isPlayerTurn&&n.board.arePositionsLocked&&(t+="dimmed-board disabled-board");return t}()),children:n.board.cells.flat().map((function(t,e){return Object(o.jsx)(j,{cell:t,owner:n,index:e},e)}))}),"cpu"===n.type&&!i&&Object(o.jsx)(S,{board:n.board})]})})),y=(n(45),Object(l.a)((function(t){var e=t.players.find((function(t){return t.board.haveAllShipsSunk}));return e?Object(o.jsxs)("div",{id:"end-message-container",children:["human"===e.type?Object(o.jsxs)(o.Fragment,{children:[Object(o.jsx)("h3",{children:"Game over!"}),Object(o.jsx)("p",{children:"You fought valiantly, but your digital opponent ultimately prevailed."})]}):Object(o.jsxs)(o.Fragment,{children:[Object(o.jsx)("h3",{children:"Victory!"}),Object(o.jsxs)("p",{children:["Congratulations, human.",Object(o.jsx)("br",{}),"You are a fine strategist."]})]}),Object(o.jsx)("button",{onClick:function(){return window.location.reload()},id:"play-again-button",children:"Play again"})]}):null}))),O=(n(46),n(5)),g=n(6),x=function(){return Object(o.jsxs)("div",{className:"footer",children:[Object(o.jsx)("div",{children:"by mangonaise"}),Object(o.jsx)(O.a,{icon:g.e,color:"rgb(230, 101, 144)"}),Object(o.jsx)("a",{href:"https://github.com/mangonaise/battleship",children:"github"})]})},P=(n(52),n(53),n(34)),C=n.n(P),w=function(t){var e=t.size,n=t.display,i=t.direction,s=Object(r.useRef)(null),a=Object(r.useState)(!1),c=Object(u.a)(a,2),l=c[0],h=c[1],p=Object(r.useState)(!1),d=Object(u.a)(p,2),f=d[0],v=d[1];function b(t,e){return document.elementsFromPoint(t,e).find((function(t){return t.classList.contains("board-cell")}))}function m(t){return new CustomEvent("shipDrag",{detail:{size:e,direction:i,dragStop:t,setIsDropPositionValid:v}})}function j(t){s.current&&(s.current.style.zIndex=t.toString())}return Object(o.jsx)("div",{children:Object(o.jsx)(C.a,{nodeRef:s,defaultPosition:{x:0,y:0},position:{x:0,y:0},scale:1,onStart:function(){j(1),h(!0)},onDrag:function(t){return function(t){var e=b(t.x,t.y);e?e.dispatchEvent(m(!1)):v(!1)}(t)},onStop:function(t){return function(t){var e=b(t.x,t.y);e&&e.dispatchEvent(m(!0)),j(0),h(!1)}(t)},children:Object(o.jsx)("div",{ref:s,className:"draggable-ship",style:{position:l?"absolute":"relative",display:n?"inline-flex":"none",flexDirection:l&&"vertical"===i?"column":"row"},children:Array.from({length:e}).map((function(t,n){return Object(o.jsx)("span",{className:"ship-placer-cell \n                ".concat(0===n?"draggable-cell":""," \n                ").concat(l?f?"dragging-valid":"dragging-invalid":""),style:S(e,n),children:0===n&&Object(o.jsx)(O.a,{icon:g.a})},n)}))})})});function S(t,e){var n="",o="";return l&&"vertical"===i?o=e<t-1?"none":"":n=e<t-1?"none":"",{borderRight:n,borderBottom:o}}},A=Object(l.a)((function(t){var e=t.user,n=Object(r.useState)("horizontal"),i=Object(u.a)(n,2),s=i[0],a=i[1];return Object(o.jsxs)("div",{id:"ship-placer-container",children:[Object(o.jsx)("h3",{children:"Place your ships to get started."}),Object(o.jsxs)("button",{onClick:function(){return e.board.clear()},className:"placement-option-button",children:[Object(o.jsx)(O.a,{className:"placement-option-icon",icon:g.g})," Clear board"]}),Object(o.jsxs)("button",{onClick:function(){return e.placeRandomShips(!0)},className:"placement-option-button",children:[Object(o.jsx)(O.a,{className:"placement-option-icon",icon:g.d})," Place randomly"]}),e.board.ships.length<10?Object(o.jsxs)("div",{children:[Object(o.jsx)("div",{id:"manual-placement-text",children:"Drag & drop"}),Object(o.jsxs)("div",{className:"direction-toggle-container",children:[Object(o.jsx)("button",{onClick:function(){return a("horizontal")},className:"placement-direction-button ".concat("horizontal"===s?"active-direction-button":""),children:Object(o.jsx)(O.a,{icon:g.b})}),Object(o.jsx)("button",{className:"placement-direction-button ".concat("vertical"===s?"active-direction-button":""),onClick:function(){return a("vertical")},children:Object(o.jsx)(O.a,{icon:g.c})}),Object(o.jsxs)("p",{children:["placing ",s,"ly"]})]})]}):Object(o.jsxs)(o.Fragment,{children:[Object(o.jsx)("h3",{style:{marginTop:"10px"},children:"Good to go!"}),Object(o.jsxs)("button",{onClick:function(){return e.board.lockShipsInPlace()},id:"start-button",className:"placement-option-button",children:[Object(o.jsx)(O.a,{className:"placement-option-icon",icon:g.f})," Start game"]})]}),Array.from({length:4}).map((function(t,n){return Object(o.jsx)("div",{className:"draggable-ship-group",children:Array.from({length:n+1}).map((function(t,i){return Object(o.jsx)(w,{size:4-n,display:e.board.numberOfShipsWithSize(4-n)<=i,direction:s},i)}))},n)}))]})})),z=Object(l.a)((function(t){var e=t.user;return Object(o.jsx)("h1",{id:"game-status",children:function(){var t,n="";if(e.board.arePositionsLocked)if(e.board.haveAllShipsSunk)n="You lose!";else if(null===(t=e.opponent)||void 0===t?void 0:t.board.haveAllShipsSunk)n="You win!";else{var i;e.isPlayerTurn?n=e.hasExtraTurn?"Hit! Extra move":"Your move":(null===(i=e.opponent)||void 0===i?void 0:i.isPlayerTurn)&&(n="Computer's move")}else n="Battleship";return n}()})})),I=n(35),N=n.n(I),E=n(21),T=n.n(E),L=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"human";Object(d.a)(this,t),this.board=void 0,this.type=void 0,this.opponent=null,this.isPlayerTurn=!1,this.hasExtraTurn=!1,this.autoAttackDelay=0,Object(v.d)(this),this.board=new b,this.type=e,"cpu"===this.type?(this.placeRandomShips(),this.board.lockShipsInPlace()):"human"===this.type&&(this.isPlayerTurn=!0)}return Object(f.a)(t,[{key:"placeRandomShips",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];e&&this.board.clear();for(var n=function(e){N()(e,(function(){for(var n=5-e;!t.board.isNextShipPlacementValid;){var i=Math.random()<.5?"horizontal":"vertical",o=Math.floor(10*Math.random()),r=Math.floor(Math.random()*(10-n)),s="horizontal"===i?[o,r]:[r,o];t.board.prepareToPlaceShip({ship:new m(n),direction:i,row:s[0],column:s[1]})}t.board.placeShip()}))},i=1;i<=4;i++)n(i)}},{key:"attack",value:function(t){if(!this.opponent)throw new Error("Can't attack as there is no opponent.");this.board.haveAllShipsSunk||this.opponent.board.haveAllShipsSunk||(this.opponent.board.receiveAttack(t),this.opponent.board.cells[t[0]][t[1]]===i.missed?(this.isPlayerTurn=!1,this.opponent.isPlayerTurn=!0,"cpu"===this.opponent.type&&this.opponent.autoAttackDelay>0&&this.opponent.autoAttack(),this.hasExtraTurn=!1):(this.hasExtraTurn=!0,"cpu"===this.type&&this.autoAttackDelay>0&&this.autoAttack()))}},{key:"autoAttack",value:function(){var t=this;if(!this.opponent)throw new Error("Can't auto attack. Opponent not found.");setTimeout((function(){return t.makeSmartMove()}),1e3*this.autoAttackDelay)}},{key:"makeSmartMove",value:function(){if(this.opponent){var t=this.opponent.board,e=t.findCellsWithState([i.shipHit]);if(0!==e.length){if(1!==e.length){var n,o=T()(e.filter((function(e){return 1===t.getAdjacentCellStates(e).filter((function(t){return t===i.shipHit})).length}))).map((function(e){var n=t.getAdjacentCellStates(e).indexOf(i.shipHit);return 0===n?e[0]+1<=9?[e[0]+1,e[1]]:void 0:1===n?e[1]+1<=9?[e[0],e[1]+1]:void 0:2===n?e[1]-1>=0?[e[0],e[1]-1]:void 0:3===n&&e[0]-1>=0?[e[0]-1,e[1]]:void 0})).filter((function(t){return void 0!==t})).filter((function(e){var n=t.cells[e[0]][e[1]];return n===i.empty||n===i.shipIntact})),r=Object(h.a)(o);try{for(r.s();!(n=r.n()).done;){var s=n.value;if(1===t.getSurroundingCellStates(s).filter((function(t){return t===i.shipHit||t===i.shipSunk})).length)return void this.attack(s)}}catch(c){r.e(c)}finally{r.f()}throw new Error("Logic error! Checked either end of hit cells and found no available space to attack.")}var a=T()(t.getAdjacentCellPositions(e[0]).filter((function(t){return void 0!==t})).filter((function(e){return t.cells[e[0]][e[1]]!==i.missed})).filter((function(e){return!t.getCornerCellStates(e).some((function(t){return t===i.shipHit||t===i.shipSunk}))})));this.attack(a[0])}else this.attackRandomCell()}}},{key:"attackRandomCell",value:function(){var t=this.opponent.board,e=t.findCellsWithState([i.empty,i.shipIntact]);if(0===(e=e.filter((function(e){return!t.getAdjacentCellStates(e).some((function(t){return t===i.shipHit||t===i.shipSunk}))&&!t.getCornerCellStates(e).some((function(t){return t===i.shipHit||t===i.shipSunk}))}))).length)throw new Error("No more positions for CPU to check. The game should have ended by now.");var n=Math.floor(Math.random()*e.length);this.attack(e[n])}}]),t}(),H=(n(90),new L("human")),D=new L("cpu");D.autoAttackDelay=1.4,H.opponent=D,D.opponent=H;var M=Object(l.a)((function(){return Object(o.jsxs)(o.Fragment,{children:[Object(o.jsx)(z,{user:H}),Object(o.jsx)("div",{id:"app-container",children:Object(o.jsxs)("div",{id:"game-container",children:[Object(o.jsx)(k,{owner:H}),!H.board.arePositionsLocked&&Object(o.jsx)(A,{user:H}),H.board.arePositionsLocked&&Object(o.jsx)(k,{owner:D}),Object(o.jsx)(y,{players:[H,D]})]})}),Object(o.jsx)(x,{})]})}));c.a.render(Object(o.jsx)(s.a.StrictMode,{children:Object(o.jsx)(M,{})}),document.getElementById("root"))}},[[91,1,2]]]);
//# sourceMappingURL=main.1a90fb57.chunk.js.map